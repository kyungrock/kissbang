<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>자유게시판 - 키스포유</title>
    <link rel="stylesheet" href="style.css" />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />
    <style>
      body {
        margin: 0;
        padding: 0;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: #f5f6fa;
      }

      .board-header {
        background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        color: white;
        padding: 20px;
        display: flex;
        align-items: center;
        gap: 15px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }

      .back-btn {
        background: rgba(255, 255, 255, 0.2);
        border: 1px solid white;
        color: white;
        padding: 8px 12px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 18px;
        transition: all 0.3s;
      }

      .board-header h1 {
        margin: 0;
        font-size: 24px;
        flex: 1;
      }

      .board-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
      }

      .board-actions {
        background: white;
        padding: 20px;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        margin-bottom: 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 15px;
      }

      .btn {
        padding: 10px 20px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.3s;
        display: inline-flex;
        align-items: center;
        gap: 8px;
      }

      .btn-primary {
        background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        color: white;
      }

      .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(17, 153, 142, 0.4);
      }

      .board-list {
        background: white;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        overflow: hidden;
      }

      .board-item {
        border-bottom: 1px solid #f0f0f0;
        padding: 20px;
        cursor: pointer;
        transition: background 0.3s;
      }

      .board-item:hover {
        background: #f8f9fa;
      }

      .board-item:last-child {
        border-bottom: none;
      }

      .board-item-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 12px;
      }

      .board-title {
        font-size: 16px;
        font-weight: 600;
        color: #333;
        margin-bottom: 8px;
      }

      .board-author {
        font-size: 14px;
        color: #666;
      }

      .board-stats {
        display: flex;
        gap: 15px;
        font-size: 13px;
        color: #999;
      }

      .board-preview {
        font-size: 14px;
        color: #666;
        margin-top: 10px;
        line-height: 1.5;
        overflow: hidden;
        text-overflow: ellipsis;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
      }

      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 1000;
        padding: 20px;
      }

      .modal.active {
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .modal-content {
        background: white;
        border-radius: 12px;
        max-width: 800px;
        width: 100%;
        max-height: 90vh;
        overflow-y: auto;
      }

      .modal-header {
        padding: 20px 30px;
        border-bottom: 1px solid #e9ecef;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .modal-header h2 {
        margin: 0;
        font-size: 20px;
        color: #333;
      }

      .modal-close {
        background: none;
        border: none;
        font-size: 24px;
        cursor: pointer;
        color: #999;
      }

      .modal-body {
        padding: 30px;
      }

      .form-group {
        margin-bottom: 20px;
      }

      .form-label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        color: #333;
        font-size: 14px;
      }

      .form-input,
      .form-textarea {
        width: 100%;
        padding: 12px;
        border: 2px solid #e9ecef;
        border-radius: 8px;
        font-size: 14px;
        box-sizing: border-box;
        font-family: inherit;
      }

      .form-input:focus,
      .form-textarea:focus {
        outline: none;
        border-color: #11998e;
      }

      .form-textarea {
        min-height: 200px;
        resize: vertical;
      }

      .post-detail-header {
        padding-bottom: 20px;
        border-bottom: 2px solid #f0f0f0;
        margin-bottom: 30px;
      }

      .post-detail-title {
        font-size: 24px;
        font-weight: 700;
        color: #333;
        margin-bottom: 15px;
      }

      .post-detail-meta {
        display: flex;
        gap: 20px;
        font-size: 14px;
        color: #666;
      }

      .post-detail-content {
        font-size: 16px;
        color: #333;
        line-height: 1.8;
        white-space: pre-wrap;
      }

      .comment-section {
        margin-top: 40px;
        padding-top: 30px;
        border-top: 2px solid #f0f0f0;
      }

      .comment-title {
        font-size: 18px;
        font-weight: 600;
        color: #333;
        margin-bottom: 20px;
      }

      .comment-list {
        margin-bottom: 20px;
      }

      .comment-item {
        padding: 15px;
        background: #f8f9fa;
        border-radius: 8px;
        margin-bottom: 10px;
      }

      .comment-header {
        display: flex;
        justify-content: space-between;
        margin-bottom: 8px;
      }

      .comment-author {
        font-weight: 600;
        color: #333;
      }

      .comment-date {
        font-size: 13px;
        color: #999;
      }

      .comment-content {
        font-size: 14px;
        color: #666;
      }

      .comment-form {
        display: flex;
        gap: 10px;
      }

      .comment-input {
        flex: 1;
        padding: 12px;
        border: 2px solid #e9ecef;
        border-radius: 8px;
        font-size: 14px;
      }

      .comment-btn {
        padding: 12px 24px;
        background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 600;
      }

      .empty-state {
        padding: 60px 20px;
        text-align: center;
        color: #666;
      }

      .empty-state i {
        font-size: 64px;
        color: #ddd;
        margin-bottom: 20px;
      }
    </style>
  </head>
  <body>
    <!-- 헤더 -->
    <div class="board-header">
      <button class="back-btn" onclick="window.history.back()">
        <i class="fas fa-arrow-left"></i>
      </button>
      <h1><i class="fas fa-comments"></i> 자유게시판</h1>
    </div>

    <!-- 컨테이너 -->
    <div class="board-container">
      <div class="board-actions">
        <h2 style="margin: 0; font-size: 18px; color: #333">
          <i class="fas fa-list"></i> 전체 글
        </h2>
        <button
          class="btn btn-primary"
          onclick="openWriteModal()"
          id="writeBtn"
          style="display: none"
        >
          <i class="fas fa-pen"></i> 글 작성
        </button>
      </div>

      <div class="board-list" id="boardList">
        <!-- 게시글이 여기 표시됩니다 -->
      </div>
    </div>

    <!-- 글 작성 모달 -->
    <div class="modal" id="writeModal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>글 작성</h2>
          <button class="modal-close" onclick="closeWriteModal()">
            &times;
          </button>
        </div>
        <div class="modal-body">
          <form id="postForm" onsubmit="submitPost(event)">
            <div class="form-group">
              <label class="form-label">제목</label>
              <input
                type="text"
                class="form-input"
                id="postTitle"
                required
                placeholder="제목을 입력하세요"
              />
            </div>

            <div class="form-group">
              <label class="form-label">내용</label>
              <textarea
                class="form-textarea"
                id="postContent"
                required
                placeholder="내용을 입력하세요"
              ></textarea>
            </div>

            <button type="submit" class="btn btn-primary" style="width: 100%">
              <i class="fas fa-check"></i> 등록하기
            </button>
          </form>
        </div>
      </div>
    </div>

    <!-- 글 상세보기 모달 -->
    <div class="modal" id="detailModal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>게시글</h2>
          <button class="modal-close" onclick="closeDetailModal()">
            &times;
          </button>
        </div>
        <div class="modal-body">
          <div id="postDetail">
            <!-- 상세 내용 -->
          </div>
          <div class="comment-section">
            <h3 class="comment-title"><i class="fas fa-comments"></i> 댓글</h3>
            <div class="comment-list" id="commentList">
              <!-- 댓글 목록 -->
            </div>
            <div class="comment-form" id="commentForm" style="display: none">
              <input
                type="text"
                class="comment-input"
                id="commentInput"
                placeholder="댓글을 입력하세요..."
              />
              <button class="comment-btn" onclick="addComment()">
                <i class="fas fa-paper-plane"></i> 등록
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="api-auth.js"></script>
    <script>
      // 게시글 데이터
      let posts = JSON.parse(localStorage.getItem('freeboard') || '[]');
      let currentPostId = null;

      // 초기 샘플 데이터
      if (posts.length === 0) {
        posts = [
          {
            id: Date.now() + 1,
            title: '키스포유 이용 팁 공유합니다',
            content:
              '안녕하세요! 키스포유를 이용하면서 알게 된 팁들을 공유합니다.\n\n1. 지역별 검색 기능을 활용하세요\n2. 관심업체는 즐겨찾기 해두면 편해요\n3. 후기를 꼭 확인하세요\n\n도움이 되셨으면 좋겠네요!',
            author: '김민수',
            date: new Date().toISOString(),
            views: 12,
            comments: [],
          },
          {
            id: Date.now() + 2,
            title: '제주도 여행 갔다왔어요',
            content:
              '제주도 여행 중에 마사지 받고 왔는데 너무 좋았어요.\n정말 피로가 싹 풀렸습니다.\n\n추천합니다!',
            author: '이영희',
            date: new Date(Date.now() - 86400000).toISOString(),
            views: 25,
            comments: [],
          },
          {
            id: Date.now() + 3,
            title: '처음 이용해봤는데 좋네요',
            content:
              '사이트 디자인도 깔끔하고 정보도 많아서 좋습니다.\n앞으로 자주 이용할 것 같아요!',
            author: '박지훈',
            date: new Date(Date.now() - 172800000).toISOString(),
            views: 18,
            comments: [],
          },
        ];
        savePosts();
      }

      // 저장
      function savePosts() {
        localStorage.setItem('freeboard', JSON.stringify(posts));
      }

      // 목록 렌더링
      function renderPosts() {
        const list = document.getElementById('boardList');

        if (posts.length === 0) {
          list.innerHTML = `
            <div class="empty-state">
              <i class="fas fa-comments"></i>
              <h3>등록된 글이 없습니다</h3>
              <p>첫 번째 글을 작성해보세요!</p>
            </div>
          `;
          return;
        }

        const sortedPosts = [...posts].sort(
          (a, b) => new Date(b.date) - new Date(a.date)
        );

        list.innerHTML = sortedPosts
          .map((post) => {
            const date = new Date(post.date);
            return `
            <div class="board-item" onclick="viewPost(${post.id})">
              <div class="board-item-header">
                <div>
                  <div class="board-title">${post.title}</div>
                  <div class="board-author">
                    <i class="fas fa-user"></i> ${post.author}
                  </div>
                </div>
              </div>
              <div class="board-preview">${post.content}</div>
              <div class="board-stats">
                <span><i class="fas fa-calendar"></i> ${date.toLocaleDateString(
                  'ko-KR'
                )}</span>
                <span><i class="fas fa-eye"></i> ${post.views}</span>
                <span><i class="fas fa-comment"></i> ${
                  post.comments.length
                }</span>
              </div>
            </div>
          `;
          })
          .join('');
      }

      // 글 상세보기
      function viewPost(id) {
        const post = posts.find((p) => p.id === id);
        if (!post) return;

        currentPostId = id;

        // 조회수 증가
        post.views++;
        savePosts();

        const date = new Date(post.date);
        const detailHtml = `
          <div class="post-detail-header">
            <div class="post-detail-title">${post.title}</div>
            <div class="post-detail-meta">
              <span><i class="fas fa-user"></i> ${post.author}</span>
              <span><i class="fas fa-calendar"></i> ${date.toLocaleDateString(
                'ko-KR'
              )}</span>
              <span><i class="fas fa-eye"></i> ${post.views}</span>
            </div>
          </div>
          <div class="post-detail-content">${post.content}</div>
        `;

        document.getElementById('postDetail').innerHTML = detailHtml;
        renderComments(post.comments);

        // 로그인 시 댓글 입력 폼 표시
        const currentUser = authManager.getCurrentUser();
        if (currentUser) {
          document.getElementById('commentForm').style.display = 'flex';
        }

        document.getElementById('detailModal').classList.add('active');
        renderPosts();
      }

      // 댓글 렌더링
      function renderComments(comments) {
        const list = document.getElementById('commentList');

        if (comments.length === 0) {
          list.innerHTML =
            '<p style="color: #999; text-align: center;">첫 댓글을 남겨보세요!</p>';
          return;
        }

        list.innerHTML = comments
          .map((comment) => {
            const date = new Date(comment.date);
            return `
            <div class="comment-item">
              <div class="comment-header">
                <span class="comment-author">${comment.author}</span>
                <span class="comment-date">${date.toLocaleDateString(
                  'ko-KR'
                )}</span>
              </div>
              <div class="comment-content">${comment.content}</div>
            </div>
          `;
          })
          .join('');
      }

      // 댓글 추가
      function addComment() {
        const currentUser = authManager.getCurrentUser();
        if (!currentUser) {
          alert('로그인이 필요합니다.');
          return;
        }

        const input = document.getElementById('commentInput');
        const content = input.value.trim();

        if (!content) {
          alert('댓글 내용을 입력하세요.');
          return;
        }

        const post = posts.find((p) => p.id === currentPostId);
        if (!post) return;

        const newComment = {
          id: Date.now(),
          author: currentUser.name,
          content: content,
          date: new Date().toISOString(),
        };

        post.comments.push(newComment);
        savePosts();
        renderComments(post.comments);
        input.value = '';

        alert('댓글이 등록되었습니다!');
      }

      // 작성 모달 열기
      function openWriteModal() {
        const currentUser = authManager.getCurrentUser();
        if (!currentUser) {
          alert('로그인이 필요합니다.');
          window.location.href = 'login.html';
          return;
        }
        document.getElementById('writeModal').classList.add('active');
      }

      // 작성 모달 닫기
      function closeWriteModal() {
        document.getElementById('writeModal').classList.remove('active');
        document.getElementById('postForm').reset();
      }

      // 상세 모달 닫기
      function closeDetailModal() {
        document.getElementById('detailModal').classList.remove('active');
        currentPostId = null;
      }

      // 글 작성
      function submitPost(event) {
        event.preventDefault();

        const currentUser = authManager.getCurrentUser();
        if (!currentUser) {
          alert('로그인이 필요합니다.');
          return;
        }

        const title = document.getElementById('postTitle').value;
        const content = document.getElementById('postContent').value;

        const newPost = {
          id: Date.now(),
          title: title,
          content: content,
          author: currentUser.name,
          date: new Date().toISOString(),
          views: 0,
          comments: [],
        };

        posts.unshift(newPost);
        savePosts();
        renderPosts();
        closeWriteModal();

        alert('글이 등록되었습니다!');
      }

      // 모달 배경 클릭 시 닫기
      window.addEventListener('click', function (e) {
        if (e.target.classList.contains('modal')) {
          e.target.classList.remove('active');
        }
      });

      // 로그인 확인
      const currentUser = authManager.getCurrentUser();
      if (currentUser) {
        document.getElementById('writeBtn').style.display = 'inline-flex';
      }

      // 초기화
      renderPosts();
    </script>
  </body>
</html>
