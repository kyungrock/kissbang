class AuthManager{constructor(){this.users = [];this.currentUser = null;this.storageKey = 'kissbang_users';this.sessionKey = 'kissbang_session';this.init();}async init(){await this.loadUsers();this.checkSession();}async loadUsers(){try{const storedUsers = localStorage.getItem(this.storageKey);if(storedUsers){this.users = JSON.parse(storedUsers);}else{this.users = [{id: 'admin-001',username: 'admin',email: 'admin@kissbang.com',password: 'admin123!',role: 'admin',name: '관리자',phone: '010-0000-0000',profileImage: '',createdAt: new Date().toISOString(),updatedAt: new Date().toISOString(),isActive: true,lastLogin: null,},];this.saveUsers();}}catch(error){console.error('사용자 데이터 로드 실패:',error);this.users = [];}}saveUsers(){try{localStorage.setItem(this.storageKey,JSON.stringify(this.users));}catch(error){console.error('사용자 데이터 저장 실패:',error);}}checkSession(){try{const session = localStorage.getItem(this.sessionKey);if(session){const sessionData = JSON.parse(session);const user = this.users.find((u)=> u.id === sessionData.userId);if(user && user.isActive){this.currentUser = user;return true;}}return false;}catch(error){console.error('세션 확인 실패:',error);return false;}}login(username,password){try{const user = this.users.find((u)=>(u.username === username || u.email === username)&& u.isActive);if(!user){throw new Error('사용자를 찾을 수 없습니다.');}if(user.password !== password){throw new Error('비밀번호가 올바르지 않습니다.');}user.lastLogin = new Date().toISOString();this.currentUser = user;localStorage.setItem(this.sessionKey,JSON.stringify({userId: user.id,username: user.username,role: user.role,loginTime: new Date().toISOString(),}));this.saveUsers();return{success: true,user: this.getSafeUser(user)};}catch(error){return{success: false,error: error.message};}}signup(userData){try{this.validateSignupData(userData);const existingUser = this.users.find((u)=> u.username === userData.username || u.email === userData.email);if(existingUser){throw new Error('이미 사용 중인 아이디 또는 이메일입니다.');}const newUser ={id: `user-${Date.now()}`,username: userData.username,email: userData.email,password: userData.password,role: 'user',name: userData.name,phone: userData.phone,profileImage: userData.profileImage || '',createdAt: new Date().toISOString(),updatedAt: new Date().toISOString(),isActive: true,lastLogin: null,};this.users.push(newUser);this.saveUsers();return{success: true,user: this.getSafeUser(newUser)};}catch(error){return{success: false,error: error.message};}}logout(){this.currentUser = null;localStorage.removeItem(this.sessionKey);}getCurrentUser(){return this.currentUser ? this.getSafeUser(this.currentUser): null;}getSafeUser(user){const{password,...safeUser}= user;return safeUser;}validateSignupData(data){if(!data.username || data.username.length < 4){throw new Error('아이디는 4자 이상이어야 합니다.');}if(!data.email || !this.isValidEmail(data.email)){throw new Error('올바른 이메일 형식이 아닙니다.');}if(!data.password || data.password.length < 6){throw new Error('비밀번호는 6자 이상이어야 합니다.');}if(!data.name || data.name.length < 2){throw new Error('이름은 2자 이상이어야 합니다.');}if(!data.phone || !this.isValidPhone(data.phone)){throw new Error('올바른 전화번호 형식이 아닙니다.');}return true;}isValidEmail(email){const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;return emailRegex.test(email);}isValidPhone(phone){const phoneRegex = /^01[0-9]-?[0-9]{3,4}-?[0-9]{4}$/;return phoneRegex.test(phone.replace(/-/g,''));}isAdmin(){return this.currentUser && this.currentUser.role === 'admin';}isLoggedIn(){return this.currentUser !== null;}}const authManager = new AuthManager();function ensureMainLandmarkId(){const candidates = [ document.getElementById('main-content'),document.querySelector('main'),document.querySelector('[role="main"]'),].filter(Boolean);if(!candidates.length){return null;}const target = candidates[0];if(!target.id){target.id = 'main-content';}else if(target.id !== 'main-content'){target.id = 'main-content';}if(!target.hasAttribute('tabindex')){target.setAttribute('tabindex','-1');}return target.id;}function insertSkipLink(){const targetId = ensureMainLandmarkId();if(!targetId || !document.body){return;}const existing = document.querySelector('.skip-nav-link');if(existing){existing.setAttribute('href',`#${targetId}`);return;}const skipLink = document.createElement('a');skipLink.className = 'skip-nav-link';skipLink.href = `#${targetId}`;skipLink.textContent = '본문으로 바로가기';skipLink.setAttribute('aria-label','본문 내용으로 바로가기');skipLink.addEventListener('click',function(event){const target = document.getElementById(targetId);if(target){target.focus();}});document.body.insertAdjacentElement('afterbegin',skipLink);}function loadHeader(){const headerContainer = document.getElementById('header-container');if(headerContainer){const headerStyle = document.createElement('style');headerStyle.textContent = ` .header{position: fixed;top: 0;left: 0;right: 0;z-index: 1000;background: linear-gradient(135deg,#667eea 0%,#764ba2 100%);box-shadow: 0 2px 10px rgba(0,0,0,0.1);transition: all 0.3s ease;}.header-content{max-width: 490px;margin: 0 auto;padding: 5px 20px;display: flex;justify-content: space-between;align-items: center;width: 100%;box-sizing: border-box;overflow-x: hidden;}@media(max-width: 480px){.header-content{padding: 5px 15px;}}@media(max-width: 320px){.header-content{padding: 5px 10px;}}.logo{font-size: 24px;font-weight: 700;color: white;display: flex;align-items: center;gap: 10px;cursor: pointer;transition: transform 0.3s ease;}.logo:hover{transform: scale(1.05);}.logo i{font-size: 28px;color: #ffd700;}.header-search-btn:hover{background: rgba(255,255,255,0.3);transform: scale(1.05);}.header-search-btn:active{transform: scale(0.95);}.header.scrolled{background: rgba(102,126,234,0.95);backdrop-filter: blur(10px);box-shadow: 0 2px 20px rgba(0,0,0,0.15);}body{padding-top: 75px;}`;document.head.appendChild(headerStyle);headerContainer.innerHTML = ` <header class="header" id="mainHeader" role="banner"> <div class="header-content"> <div class="logo" onclick="window.location.href='index.html'" style="cursor: pointer" > <i class="fas fa-spa"></i> 마사지천국 </div> <div style="display: flex;align-items: center;gap: 15px"> <div id="userInfoSection" style="display: none"> <span id="userName" style="color: white;font-weight: 600;margin-right: 10px" ></span> <button onclick="logout()" type="button" aria-label="로그아웃" style=" background: rgba(255,255,255,0.2);color: white;border: 1px solid white;padding: 8px 16px;border-radius: 6px;cursor: pointer;font-weight: 600;" > <i class="fas fa-sign-out-alt"></i> 로그아웃 </button> </div> <!-- 검색 아이콘 버튼 --> <button class="header-search-btn" id="header-search-btn" type="button" aria-label="검색 창 열기" style=" background: rgba(255,255,255,0.2);color: white;border: 1px solid white;padding: 8px 12px;border-radius: 6px;cursor: pointer;font-size: 20px;display: flex;align-items: center;justify-content: center;transition: all 0.3s;" > <i class="fas fa-search"></i> </button> <!-- 햄버거 메뉴 버튼 --> <button class="hamburger-btn" onclick="toggleSideMenu()" type="button" id="hamburgerToggleBtn" aria-label="전체 메뉴 열기" aria-controls="sideMenu" aria-expanded="false" style="margin-left: 10px" > <i class="fas fa-bars"></i> </button> </div> </div> </header> `;window.addEventListener('scroll',function(){const header = document.getElementById('mainHeader');if(header){if(window.scrollY > 50){header.classList.add('scrolled');}else{header.classList.remove('scrolled');}}},{passive: true});insertSkipLink();initializeAuth();applySearchLayoutFix();if(!window.__searchLayoutFixListenerAdded){window.addEventListener('resize',applySearchLayoutFix);window.__searchLayoutFixListenerAdded = true;}bindHeaderSearchButton();console.log('헤더 컴포넌트 로드 완료');}}function initializeAuth(){if(typeof authManager !== 'undefined' && authManager.isLoggedIn()){const user = authManager.getCurrentUser();const userInfoSection = document.getElementById('userInfoSection');const userName = document.getElementById('userName');if(userInfoSection && userName){userInfoSection.style.display = 'flex';userName.textContent = user.name + '님';if(user.role === 'admin'){const adminBtn = document.createElement('button');adminBtn.innerHTML = '<i class="fas fa-cog"></i> 관리자';adminBtn.onclick =()=>(window.location.href = 'admin.html');adminBtn.style.cssText = 'background: rgba(255,255,255,0.2);color: white;border: 1px solid white;padding: 8px 16px;border-radius: 6px;cursor: pointer;font-weight: 600;margin-right: 10px;';userInfoSection.insertBefore(adminBtn,userInfoSection.firstChild);}}}else{const userInfoSection = document.getElementById('userInfoSection');if(userInfoSection){userInfoSection.style.display = 'none';}}}function logout(){if(confirm('로그아웃 하시겠습니까?')){if(typeof authManager !== 'undefined'){authManager.logout();}location.reload();}}function applySearchLayoutFix(){const searchSection = document.querySelector('.search-section');const searchContainer = document.querySelector('.search-container');if(!searchSection || !searchContainer){return;}const screenWidth = window.innerWidth;const resetProps = [ 'padding','margin','left','right','width','maxWidth','minWidth','boxSizing','position','transform','overflowX',];const resetInlineStyles =(element)=>{resetProps.forEach((prop)=>{element.style[prop] = '';});};if(screenWidth <= 400){const isVerySmallScreen = screenWidth <= 285;const sectionPadding = isVerySmallScreen ? '10px 6px' : '15px';searchSection.style.padding = sectionPadding;searchSection.style.margin = '0 auto';searchSection.style.left = '';searchSection.style.right = '';searchSection.style.width = '100%';searchSection.style.maxWidth = '100%';searchSection.style.minWidth = '100%';searchSection.style.boxSizing = 'border-box';searchSection.style.position = 'relative';searchSection.style.transform = 'translateX(0)';searchSection.style.overflowX = 'hidden';searchContainer.style.padding = '0';searchContainer.style.margin = '0 auto';searchContainer.style.left = '';searchContainer.style.right = '';searchContainer.style.width = '100%';searchContainer.style.maxWidth = '100%';searchContainer.style.minWidth = '100%';searchContainer.style.boxSizing = 'border-box';searchContainer.style.position = 'relative';searchContainer.style.transform = 'translateX(0)';searchContainer.style.overflowX = 'hidden';}else{resetInlineStyles(searchSection);resetInlineStyles(searchContainer);}}function scrollToSearchBox(){const searchBox = document.getElementById('text-search-box')|| document.querySelector('.text-search-box');if(searchBox){applySearchLayoutFix();searchBox.style.display = getComputedStyle(searchBox).display === 'none' ? 'flex' : '';const searchInput = document.getElementById('shopSearchInput');if(searchInput){const focusOptions ={preventScroll: true};try{searchInput.focus(focusOptions);}catch(error){searchInput.focus();}if(typeof searchInput.setSelectionRange === 'function'){const length = searchInput.value.length;searchInput.setSelectionRange(length,length);}}requestAnimationFrame(()=>{const screenWidth = window.innerWidth;let headerHeight = 0;let searchBoxTop = 0;if(screenWidth >= 2500){const header = document.getElementById('mainHeader');if(header){headerHeight = header.offsetHeight;}const rect = searchBox.getBoundingClientRect();searchBoxTop = rect.top;}requestAnimationFrame(()=>{if(screenWidth >= 2500){const targetTop = window.pageYOffset + searchBoxTop - headerHeight - 20;window.scrollTo({top: targetTop > 0 ? targetTop : 0,left: 0,behavior: 'smooth',});}else{searchBox.scrollIntoView({behavior: 'smooth',block: 'center'});}});});}}function bindHeaderSearchButton(){const button = document.getElementById('header-search-btn');if(button){button.addEventListener('click',(event)=>{event.preventDefault();scrollToSearchBox();});}}function loadHamburgerMenu(){const hamburgerContainer = document.getElementById('hamburger-menu-container');if(hamburgerContainer){const style = document.createElement('style');style.textContent = ` .hamburger-btn{background: rgba(255,255,255,0.2);color: white;border: 1px solid white;padding: 8px 12px;border-radius: 6px;cursor: pointer;font-size: 20px;display: flex;align-items: center;justify-content: center;transition: all 0.3s;}.hamburger-btn:hover{background: rgba(255,255,255,0.3);}.side-menu{position: fixed;top: 0;right: -350px;width: 350px;height: 100vh;background: white;box-shadow: -2px 0 10px rgba(0,0,0,0.1);transition: right 0.3s ease;z-index: 10000;overflow-y: auto;}.side-menu.active{right: 0;}.side-menu-overlay{position: fixed;top: 0;left: 0;width: 100%;height: 100%;background: rgba(0,0,0,0.5);display: none;z-index: 9999;}.side-menu-overlay.active{display: block;}.side-menu-header{padding: 20px;background: linear-gradient(135deg,#667eea 0%,#764ba2 100%);color: white;display: flex;justify-content: space-between;align-items: center;}.side-menu-close{background: none;border: none;color: white;font-size: 24px;cursor: pointer;padding: 5px;}.side-menu-section{padding: 15px 0;border-bottom: 1px solid #eee;}.side-menu-section-title{padding: 0 20px 10px 20px;font-size: 12px;color: #999;font-weight: 600;text-transform: uppercase;}.side-menu-item{padding: 12px 20px;display: flex;align-items: center;justify-content: space-between;cursor: pointer;transition: background 0.3s;color: #333;text-decoration: none;}.side-menu-item:hover{background: #f8f9fa;}.side-menu-item-left{display: flex;align-items: center;gap: 12px;}.side-menu-item i{width: 20px;color: #667eea;}`;document.head.appendChild(style);hamburgerContainer.innerHTML = ` <!-- 햄버거 메뉴 오버레이 --> <div class="side-menu-overlay" id="sideMenuOverlay" onclick="toggleSideMenu()" ></div> <!-- 사이드 메뉴 --> <div class="side-menu" id="sideMenu"> <!-- 메뉴 헤더 --> <div class="side-menu-header"> <h2 style="margin: 0;font-size: 20px"><i class="fas fa-spa"></i> 메뉴</h2> <button class="side-menu-close" onclick="toggleSideMenu()" type="button" aria-label="메뉴 닫기" > <i class="fas fa-times"></i> </button> </div> <!-- 공지사항 / 이벤트 --> <div class="side-menu-section"> <div class="side-menu-section-title">※ 공지사항 / 이벤트</div> <div class="side-menu-item" onclick="showNotice()"> <div class="side-menu-item-left"> <i class="fas fa-bullhorn"></i> <span>공지사항</span> </div> <i class="fas fa-chevron-right"></i> </div> <div class="side-menu-item" onclick="showEvent()"> <div class="side-menu-item-left"> <i class="fas fa-gift"></i> <span>이벤트</span> </div> <i class="fas fa-chevron-right"></i> </div> </div> </div> `;console.log('햄버거 메뉴 컴포넌트 로드 완료');}}function toggleSideMenu(){const menu = document.getElementById('sideMenu');const overlay = document.getElementById('sideMenuOverlay');if(menu && overlay){const isActive = menu.classList.toggle('active');overlay.classList.toggle('active');const toggleButton = document.getElementById('hamburgerToggleBtn');if(toggleButton){toggleButton.setAttribute('aria-expanded',String(isActive));}console.log('햄버거 메뉴 토글됨');}else{console.log('메뉴 요소를 찾을 수 없습니다');}}function showNotice(){console.log('공지사항 클릭');window.location.href = 'notice.html';}function showEvent(){console.log('이벤트 클릭');window.location.href = 'event.html';}function showReviews(){window.location.href = 'reviews.html';}function showFreeBoard(){window.location.href = 'freeboard.html';}function showPartnershipForm(){window.location.href = 'partnership.html';}function showFavorites(){window.location.href = 'favorites.html';}document.addEventListener('DOMContentLoaded',function(){loadHeader();loadHamburgerMenu();});function updateHeader(){loadHeader();}function updateHamburgerMenu(){loadHamburgerMenu();}console.log('공통 컴포넌트 시스템 로드 완료');